<!DOCTYPE html>
<html>
<head>

    <title>CodeLearn</title>
    <link rel="stylesheet" href="css/style.css" type="text/css">
    <script type="text/javascript" src="index.js"></script>
  </head>
   <script src="https://code.jquery.com/jquery-3.4.1.js"></script>
  <body>

    <div class="topnav">
      <a class="active" href="#home">Home</a>
      <a href="#languages">Languages</a>
      <a href="#about">About</a>
      <a href="#contact">Contact Us</a>
      <a href="login.html" id="logout" >Log Out</a>
    </div>

    <div class="intro">
      <h1 class="logo"> CodeLearn </h1>
      <!-- <p>Select a language  from below and make corrections to the displayed code.</p> -->
    </div>
    <!-- <hr> -->
    <div class="body">

        <div class="split left">

          <form id = "question_generator" method = "POST">
              <h2>Select Language:</h2>
              <label class="container">Python
                <input type="radio" name="radio" value = "python" onclick = "get_folders()">
                <span class="checkmark"></span>
              </label>
              <label class="container">C
                <input type="radio" name="radio" value = "c" onclick = "get_folders()">
                <span class="checkmark"></span>
              </label>
          </form>
          <p><tt id="results"></tt></p>
        </div>

        <div class="split right">

            <h2>Code Segment: </h2>
            <textarea id="codesegment" wrap=on rows="14" cols="140" >


            </textarea>
            <input type="submit" class="submit" value="SUBMIT" ></input>

        </div>

        <div class="split right-most">
          <h2>Score: </h2>
            <h1 id="score">0</h1>
        </div>

    </div>

  </body>
</html>

    <script>

        var server_addr="http://0.0.0.0:80"
        function fetch_code(e) {
            // e.preventDefault();
            let myForm = document.getElementById('question_generator');
            let formData = new FormData(myForm);
            values = [];
            for (var value of formData.values()) {
              values.push(value);
            }
            var route="/get_code"
            var data_file = server_addr+route;
            var http_request = new XMLHttpRequest();
            var language = values[0];
            var category = values[1];
            var program = values[2]
            var params =JSON.stringify([language, category, program]);
            http_request.onreadystatechange = function() {//Call a function when the state changes.
                if(http_request.readyState == 4) {
                    var response = http_request.responseText;
                    p = document.getElementById("codesegment");
                    p.innerHTML = response;
                }
            }
            http_request.open('POST', data_file, true);
            http_request.send(params);
        }
        function get_programs(){
          let myForm = document.getElementById('question_generator');
          let formData = new FormData(myForm);
          values = [];
          for(var value of formData.values()){
            values.push(value)
          }
          var language = values[0];
          var category = values[1];
          var route = "/get_programs";
          var data_file = server_addr+route;
          var http_request = new XMLHttpRequest();
          var params =JSON.stringify([language, category]);
          http_request.onreadystatechange = function() {//Call a function when the state changes.
              if(http_request.readyState == 4) {
                  var response = JSON.parse(http_request.responseText);
                  var files = response['files']
                  div = document.getElementById("program");
                  if(div===null)
                  {
                    div = document.createElement("div");
                    div.setAttribute("id", "program")
                    h2 = document.createElement("h2");
                    h2.innerHTML = "Program: ";
                    div.appendChild(h2);
                    
                  }
                  else
                  {
                    div = document.getElementById("program");
                    myForm.removeChild(div);
                    var child = div.lastElementChild;  
                    div.removeChild(child);
                  }
                  var select = document.createElement("select");
                  select.setAttribute("class", "program");
                  select.setAttribute("name", "program");
                  select.setAttribute("onchange", "fetch_code()");
                  for(i = 0; i < files.length; i++)
                  {
                    var opt = document.createElement("option");
                    opt.setAttribute("value", files[i]);
                    opt.innerHTML = files[i];
                    select.appendChild(opt);
                  }
                  div.appendChild(select);
                  myForm.appendChild(div);
                
              }
          }
          http_request.open('POST', data_file, true);
          http_request.send(params);
        }
        function get_folders(){
          let myForm = document.getElementById('question_generator');
          let formData = new FormData(myForm);
          values = [];
          for(var value of formData.values()){
            values.push(value)
          }
          var language = values[0];
          var route = "/get_categories";
          var data_file = server_addr+route;
          var http_request = new XMLHttpRequest();
          var params =JSON.stringify([language]);
          http_request.onreadystatechange = function() {//Call a function when the state changes.
              if(http_request.readyState == 4) {
                  var response = JSON.parse(http_request.responseText);
                  var dirs = response['directories']
                  div = document.getElementById("category");
                  if(div===null)
                  {
                    div = document.createElement("div");
                    div.setAttribute("id", "category")
                    h2 = document.createElement("h2");
                    h2.innerHTML = "Category: ";
                    div.appendChild(h2);
                    
                  }
                  else
                  {
                    div = document.getElementById("category");
                    myForm.removeChild(div);
                    var child = div.lastElementChild;  
                    div.removeChild(child);
                    div2 = document.getElementById("program");
                    myForm.removeChild(div2)
                  }
                  var select = document.createElement("select");
                  select.setAttribute("class", "category");
                  select.setAttribute("name", "category")
                  select.setAttribute("onchange", "get_programs()");
                  for(i = 0; i < dirs.length; i++)
                  {
                    var opt = document.createElement("option");
                    opt.setAttribute("value", dirs[i]);
                    opt.innerHTML = dirs[i];
                    select.appendChild(opt);
                  }
                  div.appendChild(select);
                  myForm.appendChild(div);
                
              }
          }
          http_request.open('POST', data_file, true);
          http_request.send(params);
        }

    </script>
